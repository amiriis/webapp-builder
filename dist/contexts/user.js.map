{"version":3,"file":"user.js","names":["_react","_interopRequireWildcard","require","_axios","_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","ownKeys","keys","getOwnPropertySymbols","o","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","key","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","initialUser","isAuth","userChangedLanguage","token","user","reducer","state","action","type","user_language","language","localStorage","removeItem","setItem","UserContext","exports","createContext","UserProvider","_ref","children","url_get_user","dispatch","useReducer","clearUser","useCallback","changeUser","changeUserLanguage","changeAuthState","changeLanguageState","clearToken","setToken","getUser","callback","axios","headers","authorization","concat","then","_ref2","data","catch","error","response","status","useEffect","localToken","getItem","createElement","Provider"],"sources":["../../src/lib/contexts/user.js"],"sourcesContent":["import React, {createContext, useCallback, useEffect, useReducer} from 'react';\r\nimport axios from \"axios\";\r\n\r\nconst initialUser = {\r\n    isAuth: false,\r\n    userChangedLanguage: false,\r\n    token: null,\r\n    user: {},\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n    switch (action.type) {\r\n        case \"CLEAR_USER\":\r\n            return {...state, user: {}};\r\n        case \"CHANGE_USER\":\r\n            return {...state, user: action.user};\r\n        case \"CHANGE_USER_LANGUAGE\":\r\n            return {\r\n                ...state,\r\n                user: {...state.user, user_language: action.language},\r\n            };\r\n        case \"CHANGE_AUTH_STATE\":\r\n            return {...state, isAuth: action.isAuth};\r\n        case \"CHANGE_LANGUAGE_STATE\":\r\n            return {...state, userChangedLanguage: action.userChangedLanguage};\r\n        case \"CLEAR_TOKEN\":\r\n            localStorage.removeItem(\"_token\");\r\n            return {...state, token: null};\r\n        case \"SET_TOKEN\":\r\n            localStorage.setItem(\"_token\", action.token);\r\n            return {...state, token: action.token};\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport const UserContext = createContext();\r\n\r\nexport const UserProvider = ({children, url_get_user}) => {\r\n    const [state, dispatch] = useReducer(reducer, initialUser);\r\n\r\n    const clearUser = useCallback(() => {\r\n        dispatch({type: \"CLEAR_USER\"});\r\n    }, []);\r\n\r\n    const changeUser = useCallback((user) => {\r\n        dispatch({type: \"CHANGE_USER\", user});\r\n    }, []);\r\n\r\n    const changeUserLanguage = useCallback(/* use in multi language app */);\r\n\r\n    const changeAuthState = useCallback((isAuth) => {\r\n        dispatch({type: \"CHANGE_AUTH_STATE\", isAuth});\r\n    }, []);\r\n\r\n    const changeLanguageState = useCallback((userChangedLanguage) => {\r\n        dispatch({type: \"CHANGE_LANGUAGE_STATE\", userChangedLanguage});\r\n    }, []);\r\n\r\n    const clearToken = useCallback(() => {\r\n        dispatch({type: \"CLEAR_TOKEN\"});\r\n    }, []);\r\n\r\n    const setToken = useCallback((token) => {\r\n        dispatch({type: \"SET_TOKEN\", token});\r\n    }, []);\r\n\r\n    const getUser = useCallback(\r\n        (callback = () => {\r\n        }) => {\r\n            axios\r\n                .get(url_get_user, {\r\n                    headers: {authorization: `Bearer ${state.token}`},\r\n                })\r\n                .then(({data}) => {\r\n                    if (typeof callback === \"function\") callback(data);\r\n                })\r\n                .catch(error => {\r\n                    if (error.response.status === 401) clearToken()\r\n                })\r\n        },\r\n        [state.token]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const localToken = localStorage.getItem(\"_token\");\r\n        if (localToken) dispatch({type: \"SET_TOKEN\", token: localToken});\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!state.token) {\r\n            clearUser();\r\n            changeAuthState(false);\r\n            changeLanguageState(false);\r\n            return;\r\n        }\r\n        getUser((data) => {\r\n            changeUser(data);\r\n            changeAuthState(true);\r\n            changeLanguageState(true);\r\n        });\r\n    }, [state.token]);\r\n\r\n    return (\r\n        <UserContext.Provider\r\n            value={{\r\n                isAuth: state.isAuth,\r\n                userChangedLanguage: state.userChangedLanguage,\r\n                token: state.token,\r\n                user: state.user,\r\n                getUser,\r\n                clearUser,\r\n                changeUser,\r\n                changeUserLanguage,\r\n                changeAuthState,\r\n                changeLanguageState,\r\n                clearToken,\r\n                setToken,\r\n            }}\r\n        >\r\n            {children}\r\n        </UserContext.Provider>\r\n    );\r\n};"],"mappings":"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"}